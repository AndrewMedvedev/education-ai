import asyncio
import logging

from src.ai_agents.course_architect.content_generator import ContentContext, content_generator
from src.ai_agents.course_architect.scenario_writer import ScenarioContext, scenario_agent

INTERVIEW_SUMMARY = """## 1. Название курса  
Системы искусственного интеллекта

## 2. Целевая аудитория (самое точное описание, которое дал эксперт)  
- Возраст / опыт / бэкграунд: Студенты технических специальностей (IT, прикладная математика, компьютерные науки), 18–25 лет, без опыта в AI или с базовым пониманием программирования.  
- Главные боли / проблемы / мотивации: Не понимают, с чего начать в AI, путаются в терминах (ML, DL, NLP), боятся сложной математики, хотят понять, как работают реальные системы (например, чат-боты, рекомендации).  
- Что уже умеют (реальный стартовый уровень): Умеют писать простые программы (на Python), знают основы алгоритмов, имеют представление о данных (таблицы, списки).  
- Что категорически НЕ умеют / не понимают: Не понимают, как данные превращаются в "интеллект", не видят разницы между обучением и правилами, не знают, как оценивается качество модели.

## 3. Главные учебные цели курса (5–8 самых важных)  
1. Уметь объяснить, чем ИИ отличается от обычной программы.  
2. Понять принцип обучения моделей на примере простой задачи (например, классификация).  
3. Уметь описать, как работает нейросеть на уровне "вход – скрытые слои – выход", без формул.  
4. Понять разницу между обучением, валидацией и тестированием.  
5. Уметь интерпретировать базовые метрики (точность, полнота, F1).  
6. Понять, где ИИ работает хорошо, а где — нет (ограничения).  
7. Уметь оценить этические риски (смещение, приватность) в простых сценариях.  
8. Уметь собрать простой конвейер обработки текста или изображения с помощью готовых инструментов (например, Hugging Face, TensorFlow Lite).

## 4. Рекомендуемая структура курса (блоки / модули)  
1. Что такое ИИ: от автоматизации к обучению  
2. Основы машинного обучения: как машина "учится" на данных  
3. Нейронные сети: идея и архитектура (без математики)  
4. Обработка данных: текст, изображения, звук  
5. Оценка и тестирование моделей  
6. Практические применения: чат-боты, рекомендации, распознавание  
7. Этические и технические ограничения ИИ  
8. Мини-проект: создание простой системы (например, детектор тональности отзыва)

Логика последовательности: сначала — концептуальные основы, потом — компоненты, затем — практика и критическое мышление. Проект в конце как итог.

## 5. Ключевые темы / подтемы (то, без чего курс невозможен)  
- Модуль 1: Что такое ИИ  
  • Различие между правилами и обучением  
  • Примеры: шахматная программа vs. распознавание лиц  
  • Уровни ИИ: слабый, сильный, агенты  
- Модуль 2: Основы ML  
  • Обучение с учителем / без учителя  
  • Признаки и метки  
  • Переобучение и обобщающая способность  
- Модуль 3: Нейросети  
  • Нейрон как функция активации  
  • Прямое распространение (forward pass)  
  • Архитектуры: полносвязная, CNN, RNN — на уровне назначения  
- Модуль 4: Данные  
  • Предобработка текста (токенизация, векторизация)  
  • Предобработка изображений (нормализация, размер)  
  • Transfer learning — как использовать готовые модели  
- Модуль 5: Оценка  
  • Тренировочная, валидационная, тестовая выборки  
  • Confusion matrix, accuracy, precision, recall  
  • Кривая обучения  
- Модуль 6: Применения  
  • Чат-боты: seq2seq, трансформеры (на уровне "что делает")  
  • Рекомендательные системы: коллаборативная фильтрация  
  • Распознавание: изображения, речь  
- Модуль 7: Этические вопросы  
  • Смещение в данных (bias)  
  • Прозрачность и интерпретируемость  
  • Энергопотребление и экология  
- Модуль 8: Проект  
  • Выбор задачи  
  • Сбор данных (готовый датасет)  
  • Использование библиотеки (например, scikit-learn или Hugging Face)  
  • Демонстрация и презентация результата

## 6. Самые частые заблуждения / типичные ошибки учеников  
- ИИ "думает" как человек — возникает из-за антропоморфизации, нужно разъяснять, что это статистика.  
- Чем сложнее модель, тем лучше — студенты хотят сразу использовать GPT, но не понимают, что простые модели часто эффективнее.  
- Данные не важны, важна модель — студенты игнорируют качество данных, нужно показывать примеры с "мусором на входе — мусор на выходе".  
- Обучение = запоминание — путают переобучение с успехом, нужно объяснять разницу между точностью на трейне и тесте.  
- Все ИИ — это нейросети — не знают о других методах (деревья решений, логистическая регрессия), нужно показывать альтернативы.

## 7. Лучшие практические примеры / кейсы / задачи  
- Классификация спама по SMS: простой текст, понятная метка, можно сделать за 1 урок.  
- Распознавание рукописных цифр (MNIST): визуально понятно, можно "пощупать" изображения.  
- Анализ тональности отзывов: используя Hugging Face, один запрос — и результат, мотивирует.  
- Рекомендации фильмов: аналогия с "вам может понравиться", близко к жизни.  
- Мини-чат-бот на базе предобученной модели: показывает, что можно быстро создать работающий прототип.

## 8. Способы проверки понимания (если упоминались)  
- Тест с выбором: "Что произойдёт, если модель отлично работает на тренировочных данных, но плохо на тестовых?"  
- Задача: "Предложи способ проверить, не смещён ли датасет по гендерному признаку"  
- Практическое задание: "Обучи модель на данных Iris, оцени точность, объясни, что такое переобучение"  
- Презентация проекта: защита мини-системы с ответами на вопросы "почему так?", "что если данные изменятся?"

## 9. Важные акценты / подводные камни / «ловушки» материала  
- Не начинать с математики — это отпугивает, сначала концепции.  
- Не использовать термины без объяснения (например, "энтропия", "градиент").  
- Подчёркивать, что ИИ — не магия, а инженерия.  
- Давать только те формулы, которые действительно нужны (например, accuracy = правильно / всего).  
- Акцент на интерпретируемость: "Почему модель так решила?" — важнее, чем точность.  
- Упор на этику с первого модуля, а не в конце как "добавка".

## 10. Пропущенные важные блоки (чего не хватило в интервью)  
- Работа с реальными API (например, OpenAI, Yandex Cloud) — эксперт не говорил о практическом интегрировании.  
- DevOps для ИИ: как задеплоить модель, что такое inference, latency, scaling — не получено от эксперта.  
- Работа в команде: распределение ролей (ML-инженер, дата-сайентист, аналитик) — эксперт не затрагивал.  
- Инструменты визуализации (TensorBoard, Weights & Biases) — не упоминались.  
- Работа с несбалансированными данными — эксперт коснулся, но без конкретных методов (oversampling, F1-score).

## 11. Краткая выжимка «одним абзацем»  
Курс должен начинаться с концептуального понимания ИИ как системы, обучающейся на данных, а не следующей правилам. Основной акцент — на интуиции, а не математике, с практическими примерами, которые можно "пощупать". Важно развеять мифы, научить оценивать качество и этичность моделей, и завершить курс мини-проектом, демонстрирующим реальное применение.
"""


async def main() -> None:
    """result = await scenario_agent.ainvoke(
        {"messages": []}, context=ScenarioContext(interview_summary=INTERVIEW_SUMMARY)
    )
    print(result)
    print(result["structured_response"])"""
    from src.core.enums import ContentType

    prompt = """Ты — очень талантливый образовательный автор, специализирующийся на введении в сложные технические темы для новичков. Твой стиль: живой, понятный, немного ироничный там, где это уместно, но всегда доброжелательный и мотивирующий. Ты умеешь объяснять сложное через простые аналогии, повседневные примеры и короткие истории, избегая любой математики и сложных терминов на первом этапе.

Сейчас ты пишешь текст для **первого модуля** онлайн-курса «Системы искусственного интеллекта».

Название модуля:  
**Что такое ИИ: от автоматизации к обучению**

Целевая аудитория:  
Студенты технических специальностей (IT, прикладная математика, компьютерные науки), 18–25 лет. Умеют писать простой код на Python, знают основы алгоритмов и структур данных.  
Боли: не понимают, с чего начать в AI, путаются в терминах (ML, DL, NLP), боятся сложной математики, хотят понять, как реально работают чат-боты, рекомендации и распознавание лиц.

Главные цели именно этого модуля (должны быть явно или неявно достигнуты в тексте):
- Уметь объяснить, чем ИИ отличается от обычной программы.
- Развеять главное заблуждение: ИИ НЕ думает как человек — это статистика, а не сознание.
- Показать разницу между правиловыми (rule-based) системами и системами, которые учатся на данных.
- Дать первые яркие примеры, чтобы студент почувствовал «вау, вот как это работает на самом деле».

Обязательные акценты и правила (строго соблюдай):
- Никакой математики, никаких формул, никаких слов «градиент», «энтропия», «веса», «нейрон» (это будет позже).
- Подчёркивай с самого начала: ИИ — это НЕ магия, а инженерия + очень много данных.
- Развеивай мифы мягко, но уверенно, особенно: «ИИ думает как человек», «чем сложнее — тем лучше», «все ИИ — это нейросети».
- Этику и ограничения начинай вводить уже здесь, очень лёгкими штрихами (1–2 предложения), чтобы они не казались «добавкой» в конце курса.
- Используй разговорный, но не детский язык. Много риторических вопросов, прямого обращения («Представьте, что вы…», «А теперь подумайте…»).
- Длина текста: 1200–1800 слов (примерно 5–7 экранов при чтении на телефоне/ноутбуке).
- Структура модуля (обязательно следуй этой последовательности):

1. Яркое введение (150–250 слов)  
   Захвати внимание: короткая история или вопрос про повседневный ИИ (чат-бот, рекомендация в YouTube/Netflix, распознавание лица в телефоне).  
   Задай интригу: «А вы знаете, что большинство из этих систем вообще не следуют жёстким правилам, как обычные программы?»

2. Что такое обычная программа (rule-based система) (300–400 слов)  
   Простая аналогия (светофор, калькулятор, шахматная программа Deep Blue).  
   Плюсы и минусы: очень надёжно, но жёстко, не умеет подстраиваться под новое.

3. А что если система может учиться? (главный поворот модуля) (400–600 слов)  
   Ключевая разница: вместо «если-то» программист даёт примеры → система сама находит закономерности.  
   Яркие примеры (выбери 2–3):  
   - Распознавание лиц vs шахматная программа  
   - Фильтр спама в почте (раньше — правила, сейчас — учится на твоих пометках)  
   - Рекомендации в TikTok / YouTube (почему они так быстро «попадают в мозг»)  
   Подчеркни: это не сознание, а очень продвинутая статистика на огромных данных.

4. Короткий разбор самых частых заблуждений (200–300 слов)  
   3–4 главных мифа из списка:  
   - ИИ думает как человек  
   - Все ИИ — это большие нейросети  
   - Чем сложнее модель — тем лучше всегда

5. Первые намёки на ограничения и этику (100–150 слов)  
   Лёгкие примеры: что будет, если данные плохие? Может ли система «научиться» предрассудкам? Почему ИИ иногда ошибается глупо?

6. Краткий итог модуля и переход к практике (150–200 слов)  
   4–5 ключевых тейкэвеев в виде маркированного списка.  
   Вопрос для размышления + анонс следующего модуля: «А теперь давайте посмотрим, как именно машина учится на примерах…»

Форматирование:  
Используй markdown:  
## Подзаголовки второго уровня  
### Третьего уровня — для подтем  
- маркированные списки  
**жирный** для ключевых мыслей  
> цитаты / аналогии  
(если нужно — места для будущих изображений / схем, например: [Здесь будет простая схема: правила vs обучение])

Тон: мотивирующий, честный, немного вдохновляющий («Вы уже на пороге понимания того, как создаются технологии, которыми пользуются миллиарды людей каждый день»).

Начинай писать сразу с заголовка модуля. Не добавляй никаких комментариев вне текста модуля."""

    result = await content_generator.ainvoke(
        {"messages": [("human", prompt)]},
        context=ContentContext(content_type=ContentType.TEXT),
        config={"configurable": {"thread_id": "123"}},
    )
    print(result["structured_response"])


if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    asyncio.run(main())
